{% macro code_snippet(
        source='Set source= to view source here', 
        language='markup', 
        show_copy_button=true, 
        class=false, 
        beautify=false, 
        preformatted=false,
        reference_link_text="Reference Link", 
        reference_link_href=false,
        copy_code_text="Copy Code",
        filename=false) %}
        {% set button_component_import_path = button_component_import_path | default('./button/button.njk') %}
        {% from button_component_import_path import button with context %}

    {% set id = range(0, 100000) | random %}
    {% if language == 'njk' %}
        {% set language = 'twig' %}
    {% endif %}

    {% if language != 'css' and language != 'scss' and language != 'markup' and language != 'html'  %}
        {% set preformatted = true %}
    {% endif %}

    <div class="esds-code-snippet{{ ' ' + class if class }}">
        {% if show_copy_button or filename %}
            <div class="esds-code-snippet__header">
                {% if filename %}
                    <span class="esds-code-snippet__filename">{{ filename }}</span>
                {% endif %}
                <div class="esds-code-snippet__copy-code-wrap">
                    {{ button(text=copy_code_text) }}
                </div>
            </div>
        {% endif %}
        <div id="esds-code-snippet--{{ id }}" class="esds-code-snippet__source">
            <pre class="esds-code-snippet__pre"><code class="language-{{ language }}">
                {%- if preformatted -%}
                    {{- source | stripindent | trim -}}
                {%- elseif language == 'css' or language == 'scss' -%}
                    {{- source | trim | cssbeautify -}}
                {%- else -%}
                    {{- source | stripindent | htmlbeautify -}}
                {%- endif -%}
            </code></pre>
        </div>
    </div>
{% endmacro %}
